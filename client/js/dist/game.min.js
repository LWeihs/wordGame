!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";const e={player_name_max_len:8,room_name_max_len:8,player_list_div_height:65,connect_try_interval:2e3,game_error_persistance:2e3,active_typer_persistance:5e3,winner_msg_persistance:5e3,image_folder_path:"images",images:{tick:"tick.png",cross:"cross.png",trophy:"trophy.png",crown:"crown.png"},image_sizes:{crown:{width:40,height:20}},highlight_colors:{0:"#ff0000",1:"#ff7f00",2:"#ffff00",3:"#00ff00",4:"#0000ff",5:"#4b0082",default:"#9400d3"}};function t(e,t){!function(e,t){["input","keydown","keyup","mousedown","mouseup","select","contextmenu","drop"].forEach(s=>{e.addEventListener(s,(function(){t.test(this.value)?(this.oldValue=this.value,this.oldSelectionStart=this.selectionStart,this.oldSelectionEnd=this.selectionEnd):this.hasOwnProperty("oldValue")?(this.value=this.oldValue,this.setSelectionRange(this.oldSelectionStart,this.oldSelectionEnd)):this.value=""}))})}(e,new RegExp(`^[0-9]{0,${t}}$`))}const s={time_map:new Map([[1,"red"],[3,"yellow"]]),default:"green"};let i={id:void 0,target_room:null,is_lead:!1},a={teams_enabled:!1,game_in_progress:!1};const n=new class{init(){this._room_name=document.querySelector("#banner-header .main"),this._private_notice=document.querySelector("#banner-header .private-notice")}setRoomName(e){this._room_name.innerHTML=`* * * ${e} * * *`}setPrivateNoticeVisibility(e){this._private_notice.style.display=e?"":"none"}},r=new class{init(){this._page_content=document.querySelector("#page-wrap"),this._connect_message_wrap=document.querySelector("#connect-message-wrap"),this._connect_message=document.querySelector("#connect-message"),this._repeating_interval=null}setConnectMessage(e){this._connect_message.innerHTML=e}switchVisibilityToPageContent(){this._connect_message_wrap.style.display="none",this._page_content.style.display="flex"}retryConnection(t){this._repeating_interval||(this._repeating_interval=setInterval(()=>{t.emit("retry-connect")},e.connect_try_interval))}stopOngoingConnectionAttempts(){this._repeating_interval&&clearInterval(this._repeating_interval)}},o=new class{initControls(){this._player_list=document.querySelector("#player-items"),this._element_update_fns={},this._must_set_team_input={}}initSocket(e){this._socket=e}createPlayerElements(e){this._clearExistingElements();for(let t=0;t<e;++t){const e={set_name:()=>{},set_wins:()=>{},switch_ready_state:()=>{},switch_team_visibility:()=>{},enable_team_input:()=>{},set_team_str:()=>{},set_team_input:()=>{},set_room_lead:()=>{},set_current_player:()=>{},set_alive:()=>{},switch_to_empty:()=>{},switch_to_filled:()=>{}},s=this._createPlayerListItem(e);this._player_list.appendChild(s),this._element_update_fns[t]=e,this._must_set_team_input[t]=!0}this._processCreatedPlayerList()}updatePlayerList(e,t,s){s.forEach((s,i)=>{s?this._updatePlayerListSlotFilled(i,e,t,s):this._updatePlayerListSlotEmpty(i)})}prepareForGameStart(){Object.keys(this._must_set_team_input).forEach(e=>{this._must_set_team_input[e]=!0})}_clearExistingElements(){this._player_list.innerHTML=""}_createPlayerListItem(e){const t=this._createContainerItem(e),s=this._createEmptyPlayerItem();t.appendChild(s);const i=this._createFilledPlayerItem(e);return i.style.display="none",t.appendChild(i),e.switch_to_empty=()=>{i.style.display="none",s.style.display=""},e.switch_to_filled=()=>{s.style.display="none",i.style.display=""},e.set_current_player=e=>{e?this._addCurrentPlayerStateToItem(i):this._removeCurrentPlayerStateFromItem(i)},e.set_alive=e=>{e?this._removeDefeatedStateFromItem(i):this._addDefeatedStateToItem(i)},t}_createContainerItem(t){const s=document.createElement("div");return s.classList.add("player-item-container"),s.style.height=e.player_list_div_height+"px",s}_createEmptyPlayerItem(){const e=document.createElement("div");return e.classList.add("unfilled-player-item"),e.innerHTML="- Free -",e}_createFilledPlayerItem(e){const t=document.createElement("div");t.classList.add("filled-player-item");const s=this._createWinTrackerWrap(e);t.appendChild(s);const i=this._createNameTagWrap(e);t.appendChild(i);const a=this._createPlayerStatusWrap(e);return t.appendChild(a),t}_createWinTrackerWrap(e){const t=document.createElement("div");t.classList.add("win-tacker-wrap");const s=this._createTrophyImage(),i=this._createWinCount(e);return t.appendChild(s),t.appendChild(i),t}_createTrophyImage(){const t=document.createElement("img");return t.src=`${e.image_folder_path}/${e.images.trophy}`,t.alt="wins:",t.classList.add("player-list-img"),t.width=e.player_list_div_height,t}_createWinCount(e){const t=document.createElement("div");t.classList.add("win-count-wrap");const s=document.createElement("span");s.innerHTML="x";const i=document.createElement("span");return t.appendChild(s),t.appendChild(i),e.set_wins=e=>{i.innerHTML=e},t}_createNameTagWrap(e){const t=document.createElement("div");t.classList.add("name-tag-wrap");const s=this._createNameTag(e),i=this._createCrownImage();i.style.display="none",s.appendChild(i),t.appendChild(s);const a=this._createTeamTag(e);return a.style.display="none",t.appendChild(a),e.set_room_lead=e=>{i.style.display=e?"":"none"},t}_createNameTag(e){const t=document.createElement("div");t.classList.add("player-name-tag");const s=document.createElement("div");return s.classList.add("player-name"),t.appendChild(s),e.set_name=e=>{s.innerHTML=e},t}_createCrownImage(){const t=document.createElement("img");return t.src=`${e.image_folder_path}/${e.images.crown}`,t.alt="room lead",t.width=e.image_sizes.crown.width,t.height=e.image_sizes.crown.height,t}_createTeamTag(e){const t=document.createElement("div");t.classList.add("player-team-tag");const s=document.createElement("div");s.classList.add("player-team-name"),t.appendChild(s);const i=this._createTeamChangeForm(e);return i.style.display="none",t.appendChild(i),e.set_team_str=e=>{s.innerHTML=e},e.switch_team_visibility=e=>{t.style.display=e?"":"none"},t}_createTeamChangeForm(e){const s=document.createElement("form");s.classList.add("team-set"),s.autocomplete="off";const i=document.createElement("input");i.type="text",i.id="team-set-text",t(i,2);const a=()=>{const e=i.value.length;i.style.width=(e>0?e:1)+"em"};a(),i.addEventListener("input",()=>{a(),i.value&&this._socket.emit("change-team",parseInt(i.value))});const n=document.createElement("label");return n.setAttribute("for","team-set-text"),s.appendChild(n),s.appendChild(i),e.enable_team_input=e=>{s.style.display=e?"":"none"},e.set_team_input=e=>{i.value=e},s}_createPlayerStatusWrap(e){const t=document.createElement("div");t.classList.add("player-status-wrap");const s=this._createReadyStatusImage(e);return t.appendChild(s),t}_createReadyStatusImage(t){const s=document.createElement("img"),i=t=>{const i=t?e.images.tick:e.images.cross,a=`${e.image_folder_path}/${i}`,n=t?"ready":"not ready";s.src=a,s.alt=n};return i(!1),s.classList.add("player-list-img"),s.width=e.player_list_div_height,t.switch_ready_state=i,s}_addCurrentPlayerStateToItem(e){e.classList.add("current-player")}_removeCurrentPlayerStateFromItem(e){e.classList.remove("current-player")}_addDefeatedStateToItem(e){e.classList.add("defeated")}_removeDefeatedStateFromItem(e){e.classList.remove("defeated")}_processCreatedPlayerList(){const e=document.querySelector("#remaining-space"),t=()=>{0===e.clientHeight?e.style.border="0":e.style.border=""};setTimeout(()=>{t()},1),window.addEventListener("resize",t)}_updatePlayerListSlotEmpty(e){this._element_update_fns[e].switch_to_empty()}_updatePlayerListSlotFilled(e,t,s,i){this._adaptPlayerInfo(t,i);const a=this._element_update_fns[e];a.set_name(i.name),a.set_wins(i.wins),a.switch_ready_state(i.ready),a.set_room_lead(i.is_room_lead),a.set_current_player(i.is_current_player),a.set_alive(i.alive),a.switch_team_visibility(s.teams_enabled);let n=!1,r="Team";s.game_in_progress||t.id!==i.id?r+=" "+i.team:n=!0,a.set_team_str(r),this._must_set_team_input[e]&&(a.set_team_input(i.team),this._must_set_team_input[e]=!1),a.enable_team_input(n),a.switch_to_filled()}_adaptPlayerInfo(e,t){e.id===t.id&&(t.name+=" (You)")}},l=new class{initControls(){this._game_content=document.querySelector("#game-content"),this._game_input_form=document.querySelector("#game-input-form"),this._game_input_text=document.querySelector("#game-input-text"),this._previous_words=null,this._hint_word=document.querySelector(".next-word-hint"),this._game_cur_typer=document.querySelector("#game-cur-player-tag"),this._typed_word=document.querySelector("#game-typed-word"),this._typing_error=document.querySelector("#typing-error"),this._cur_player_reminders=document.querySelectorAll(".your-turn-label"),this._idle_message=document.querySelector("#game-idle-message"),this._last_typed=null,this._idle_blocked=!1,this._idle_timeout=void 0,this._queued_idle_message=void 0,this._can_multiple_players_talk=!1,this._cur_typer_fallback="",this._cur_typer_reset_timeout=null,this._game_error_reset_timeout=null}initSocketEvents(e){this._game_input_form.addEventListener("submit",t=>{t.preventDefault();const s=this._game_input_text.value;this._game_input_text.value="",e.emit("process-game-input",s)}),this._game_input_text.addEventListener("input",t=>{e.emit("player-typing",this._game_input_text.value)})}createPrevTypedDivs(e){const t=document.querySelector("#game-upper");for(let s=0;s<e;++s){const e=document.createElement("div");e.classList.add("previously-typed-word"),t.insertBefore(e,t.firstChild)}this._previous_words=document.querySelectorAll(".previously-typed-word"),this._last_typed=new Array(this._previous_words.length)}reset(){this.clearPrevTypedDivs(),this.clearTypedText(),this.clearGameError(),this._previous_words&&(this._last_typed=new Array(this._previous_words.length))}hideGameContent(){this._game_content.style.display="none"}showGameContent(){this._game_content.style.display=""}handleActivePlayerChange(e,t){let s,i=!1;for(const{user_id:s}of t.players)if(e.id===s){i=!0;break}i?this.showCurrentPlayerReminders():this.hideCurrentPlayerReminders(),t.is_team?(this._can_multiple_players_talk=!0,this._cur_typer_fallback=t.team,s=t.team):s=t.players[0].name,this.showActiveTyper(s)}hideCurrentPlayerReminders(){this._game_content.classList.remove("current-player"),this._cur_player_reminders.forEach(e=>{e.style.display="none"})}showCurrentPlayerReminders(){this._game_content.classList.add("current-player"),this._cur_player_reminders.forEach(e=>{e.style.display=""})}showActiveTyper(t){this._cur_typer_reset_timeout&&clearTimeout(this._cur_typer_reset_timeout),this._game_cur_typer.innerHTML=t,this._can_multiple_players_talk&&(this._cur_typer_reset_timeout=setTimeout(()=>{this._game_cur_typer.innerHTML=this._cur_typer_fallback,this.showTypedText("")},e.active_typer_persistance))}showTypedText(e){e||(e="..."),this._typed_word.innerHTML=e}clearTypedText(){this._typed_word.innerHTML="..."}setGameError(t){this._game_error_reset_timeout&&(clearTimeout(this._game_error_reset_timeout),this._game_error_reset_timeout=null),this._typing_error.innerHTML=t.toUpperCase(),this._game_error_reset_timeout=setTimeout(()=>{this.clearGameError()},e.game_error_persistance)}clearGameError(){this._game_error_reset_timeout&&(clearTimeout(this._game_error_reset_timeout),this._game_error_reset_timeout=null),this._typing_error.innerHTML=""}insertNewWord(e){this._updateLastTyped(e),this._updateHintDiv(),this._updatePrevTypedDivs()}clearPrevTypedDivs(){this._previous_words&&this._previous_words.forEach(e=>{e.innerHTML=""})}setIdleMessage(e){this._idle_blocked?this._queued_idle_message=e:this._idle_message.innerHTML=e}clearIdleMessage(){this._idle_message.innerHTML=""}blockIdleMessageSetting(e){this._idle_blocked=!0,this._idle_timeout=setTimeout(()=>{this._idle_blocked=!1,this._queued_idle_message&&(this.setIdleMessage(this._queued_idle_message),this._queued_idle_message=void 0)},e)}unblockIdleMessageSetting(){this._idle_blocked=!1,clearTimeout(this._idle_timeout)}_updateLastTyped(e){let t=e;for(let e=0;e<this._last_typed.length;++e){const s=this._last_typed[e];this._last_typed[e]=t,t=s}}_updateHintDiv(){const e=this._last_typed[0];if(!e)return;const t=e[e.length-1],s=this._getHighlightColorByIdx(0),i=this._createHighlightedLetter(t,s);this._hint_word.innerHTML=i+"...?"}_updatePrevTypedDivs(){const e=this._previous_words.length-1;let t=0;for(;t<this._last_typed.length;++t){const s=this._last_typed[t];if(!s)break;const i=s[0];let a;if(this._last_typed[t+1]){const e=this._getHighlightColorByIdx(t+1);a=this._createHighlightedLetter(i,e)}else a=i;const n=s[s.length-1],r=this._getHighlightColorByIdx(t),o=this._createHighlightedLetter(n,r),l=s.slice(1,s.length-1),_=this._previous_words[e-t];_.style.display="",_.innerHTML=`${a}${l}${o}`}for(;t<this._previous_words.length;++t)this._previous_words[e-t].style.display="none"}_getHighlightColorByIdx(t){return e.highlight_colors.hasOwnProperty(t)?e.highlight_colors[t]:e.highlight_colors.default}_createHighlightedLetter(e,t){return`<span style="color:${t};">${e}</span>`}},_=new class{init(){this._timer=document.querySelector("#time-ticker"),this._time_interval=null}startTimer(e){this._time_interval&&clearInterval(this._time_interval),this._setTime(e),this._time_interval=setInterval(()=>{e--,this._setTime(e),0===e&&(this.clearTimerInterval(),this._time_interval=null)},1e3)}clearTimerInterval(){clearInterval(this._time_interval)}_setTime(e){this._timer.innerHTML=e,this._setTimerColor(e)}_setTimerColor(e){let t;for(const[i,a]of s.time_map.entries())if(e<=i){t=a;break}t||(t=s.default),this._timer.style.backgroundColor=t}},c=new class{constructor(){this._chat="",this._socket=null}initControls(){this._controls={input_form:document.querySelector("#chat-input-form"),input_text:document.querySelector("#chat-input-text"),text_field:document.querySelector("#chat-text-area")},this._controls.input_form.addEventListener("submit",e=>{e.preventDefault(),this._socket&&this._sendChatMessage()})}initSocketEvents(e){this._socket=e}addChatMessage(e){this._chat&&(this._chat+="</br>"),this._chat+=e,this._controls.text_field.innerHTML=this._chat,this._scrollChatToBottom()}_sendChatMessage(){const e=this._controls.input_text.value;this._socket.emit("process-chat-input",e),this._controls.input_text.value=""}_scrollChatToBottom(){this._controls.text_field.scrollTop=this._controls.text_field.scrollHeight}},d=new class{initControls(){this._fixed_settings=document.querySelector("#game-opts-settings-fixed"),this._changeable_settings=document.querySelector("#game-opts-settings-changeable")}initSocketEvents(e){const s=t=>{const s=`.${t} .dropright-content > div`;this._changeable_settings.querySelectorAll(s).forEach(s=>{s.addEventListener("click",()=>{const i={[t]:s.innerHTML};e.emit("change-game-option",i)})})};s("mode"),s("teams");const i=this._changeable_settings.querySelector("#turn-timer-input");t(i,2),i.addEventListener("input",()=>{e.emit("change-game-option",{timer:1e3*parseInt(i.value)})})}enableSettingChanging(){this._fixed_settings.style.display="none",this._changeable_settings.style.display=""}disableSettingChanging(){this._changeable_settings.style.display="none",this._fixed_settings.style.display=""}setOptions(e,t){this._setFixedOptions(e),this._setChangeableOptions(e,t)}_setFixedOptions(e){this._setServerSetOptions(this._fixed_settings,e)}_setChangeableOptions(e,t){this._setServerSetOptions(this._changeable_settings,e),t&&this._setServerOverridableOptions(this._changeable_settings,e)}_setServerSetOptions(e,t){e.querySelectorAll(".server-set").forEach(e=>{Object.keys(t).forEach(s=>{e.classList.contains(s)&&this._setElementText(e,t[s])})})}_setServerOverridableOptions(e,t){e.querySelectorAll(".server-overridable").forEach(e=>{Object.keys(t).forEach(s=>{e.classList.contains(s)&&this._setElementText(e,t[s])})})}_setElementText(e,t){let s;switch(e.nodeName){case"INPUT":s="value";break;default:s="innerHTML"}e[s]=t}},h=new class{initControls(){this._socket=null,this._readyButton=document.querySelector("#game-ready-button"),this._startButton=document.querySelector("#game-start-button")}initSocketEvents(e){this._readyButton.addEventListener("click",()=>{e.emit("change-ready-state")}),this._startButton.addEventListener("click",()=>{e.emit("start-game")})}setButtonAsReadyButton(){this._readyButton.classList.remove("negative-action"),this._readyButton.classList.add("positive-action"),this._readyButton.innerHTML="Ready!"}setButtonAsCancelButton(){this._stripStateClasses(this._readyButton),this._readyButton.classList.add("negative-action"),this._readyButton.innerHTML="Cancel"}enableReadyButton(){this._stripStateClasses(this._readyButton),this._readyButton.classList.add("positive-action"),this._readyButton.disabled=!1}disableReadyButton(){this._stripStateClasses(this._readyButton),this._readyButton.classList.add("inactive-action"),this._readyButton.disabled=!0}enableStartButton(){this._stripStateClasses(this._startButton),this._startButton.classList.add("positive-action"),this._startButton.disabled=!1}disableStartButton(){this._stripStateClasses(this._startButton),this._startButton.classList.add("inactive-action"),this._startButton.disabled=!0}switchToRoomRegularUserState(){this._readyButton.style.display="",this._startButton.style.display="none"}switchToRoomLeadState(){this._readyButton.style.display="none",this._startButton.style.display=""}_stripStateClasses(e){e.classList.remove("positive-action"),e.classList.remove("negative-action"),e.classList.remove("inactive-action")}};function m(){_.clearTimerInterval(),l.hideGameContent(),l.reset(),i.is_lead||(h.enableReadyButton(),h.setButtonAsReadyButton())}window.addEventListener("load",(function(){const t=new URLSearchParams(window.location.search),s=t.get("room");if(!s)return void(document.querySelector("#connect-message").innerHTML="No room given! Cannot connect.");const u=t.get("userName"),p=t.get("makePrivate");document.querySelectorAll("form").forEach(e=>{e.addEventListener("submit",e=>{e.preventDefault()})});const y={};var g;Object.entries(e.images).forEach(([t,s])=>{y[t]=`${e.image_folder_path}/${s}`}),g=y,Object.entries(g).forEach(([e,t])=>{(new Image).src=t}),r.init(),n.init(),o.initControls(),_.init(),l.initControls(),c.initControls(),d.initControls(),h.initControls(),function(t,s,u){let p="source=game_room&room="+t;s&&(p+="&name="+s);u&&(p+="&make_private=true");i.target_room=t;const y=io({transports:["websocket"],upgrade:!1,query:p});(function(e){e.on("initial-connection-established",e=>{d.disableSettingChanging(),h.switchToRoomRegularUserState(),m(),i.id=e.id}),e.on("room-join-accepted",e=>{const{max_players:t,no_remembered_words:s,is_private:a}=e;r.stopOngoingConnectionAttempts(),n.setRoomName(i.target_room),n.setPrivateNoticeVisibility(a),o.createPlayerElements(t),l.createPrevTypedDivs(s),r.switchVisibilityToPageContent()}),e.on("room-join-rejected",t=>{r.setConnectMessage(t),r.retryConnection(e)}),e.on("make-room-lead",()=>{d.enableSettingChanging(),h.switchToRoomLeadState(),i.is_lead=!0})})(y),function(e){e.on("set-ready",()=>{h.setButtonAsCancelButton()}),e.on("set-not-ready",()=>{h.setButtonAsReadyButton()}),e.on("can-start-game",()=>{h.enableStartButton()}),e.on("can-not-start-game",()=>{h.disableStartButton()})}(y),function(e){e.on("refresh-players",e=>{o.updatePlayerList(i,a,e)}),e.on("refresh-options",(e,t)=>{a.teams_enabled=e.teams;const s=function(e){const t={};return Object.entries(e).forEach(([e,s])=>{let i;switch(e){case"teams":i=s?"On":"Off";break;case"mode":switch(s){case"last_letter":i="Last Letter"}break;case"timer":i=s/1e3;break;default:i=s}t[e]=i}),t}(e);d.setOptions(s,t)}),e.on("receive-chat-message",e=>{c.addChatMessage(e)}),e.on("receive-idle-message",e=>{l.setIdleMessage(e)})}(y),function(t){t.on("prepare-for-game-start",()=>{a.game_in_progress=!0,i.is_lead&&d.disableSettingChanging(),l.unblockIdleMessageSetting(),l.clearIdleMessage(),l.showGameContent(),h.disableReadyButton(),o.prepareForGameStart()}),t.on("active-player-change",e=>{l.handleActivePlayerChange(i,e)}),t.on("start-timer",e=>{_.clearTimerInterval(),_.startTimer(e/1e3)}),t.on("current-player-typing",(e,t)=>{l.showActiveTyper(e),l.showTypedText(t)}),t.on("receive-valid-word",e=>{l.clearGameError(),l.clearTypedText(),l.insertNewWord(e)}),t.on("receive-word-error",e=>{l.setGameError(e)}),t.on("game-end",()=>{a.game_in_progress=!1,i.is_lead&&d.enableSettingChanging(),m()}),t.on("announce-winner",t=>{l.setIdleMessage(t),l.blockIdleMessageSetting(e.winner_msg_persistance)})}(y),o.initSocket(y),c.initSocketEvents(y),l.initSocketEvents(y),h.initSocketEvents(y,i),d.initSocketEvents(y)}(s,u,p)}))}));